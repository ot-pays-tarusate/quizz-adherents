<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Challenge du Partenaire Expert - Pays Tarusate</title>
    
    <style>
        /* --- CHARTE GRAPHIQUE PAYS TARUSATE --- */
        :root { 
            --primary: #88b04b; /* Vert "C≈ìur des Landes" */
            --primary-dark: #6b8f3a; 
            --secondary: #e67e22; /* Orange */
            --bg-color: #f9fbf9; 
            --card-bg: #ffffff; 
            --text-main: #2d3748; 
            --success: #48bb78; 
            --error: #e53e3e; 
            --info: #3182ce; 
        }

        body { 
            font-family: 'Segoe UI', 'Roboto', sans-serif; 
            background-color: var(--bg-color);
            color: var(--text-main); 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
            /* Motif subtil pour habiller le fond */
            background-image: radial-gradient(#88b04b20 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* --- √âL√âMENTS VISUELS (Vagues) --- */
        .wave-top {
            position: fixed; top: 0; left: 0; width: 100%; height: 140px; z-index: -1;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-bottom-left-radius: 50% 20%;
            border-bottom-right-radius: 50% 20%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .progress-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 8px; background: rgba(255,255,255,0.3); z-index: 1000; 
        }
        .progress-bar { 
            height: 100%; background: var(--secondary); width: 0%; transition: width 0.4s ease; box-shadow: 0 0 10px var(--secondary);
        }

        .container { max-width: 800px; margin: 60px auto; padding: 20px; position: relative; }

        /* --- HEADER --- */
        header { 
            text-align: center; 
            background: var(--card-bg); 
            padding: 40px 30px; 
            border-radius: 25px; 
            box-shadow: 0 15px 35px rgba(136, 176, 75, 0.15); 
            margin-bottom: 40px; 
            animation: slideDown 0.8s ease-out; 
            position: relative;
            border-top: 6px solid var(--secondary);
        }

        h1 { color: var(--primary-dark); margin: 0 0 10px 0; font-size: 2.2em; letter-spacing: -0.5px; }
        .intro { color: #718096; font-size: 1.1em; line-height: 1.6; }
        
        /* --- Autres Styles --- */
        .section-badge { display: inline-block; background: var(--primary); color: white; padding: 8px 20px; border-radius: 50px; font-weight: bold; font-size: 0.9em; margin: 30px 0 15px 0; box-shadow: 0 4px 10px rgba(136, 176, 75, 0.4); opacity: 0; animation: fadeIn 0.5s forwards; }
        .card { background: var(--card-bg); border-radius: 20px; padding: 30px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); border: 1px solid #f0f0f0; transition: transform 0.3s, box-shadow 0.3s; opacity: 0; transform: translateY(20px); animation: fadeInUp 0.6s forwards; border-left: 6px solid transparent; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.08); }
        .card.answered { border-left-color: var(--primary); }
        h3 { margin-top: 0; color: #2d3748; font-size: 1.25em; }
        .hint { color: #a0aec0; font-style: italic; font-size: 0.9em; display: block; margin-bottom: 20px; }
        .options-grid { display: flex; flex-direction: column; gap: 12px; }
        .option-btn { background: #fff; border: 2px solid #edf2f7; padding: 15px 20px; border-radius: 15px; cursor: pointer; text-align: left; font-size: 1em; transition: all 0.2s; display: flex; align-items: center; position: relative; overflow: hidden; }
        .option-btn:hover:not(.disabled) { border-color: var(--primary); background: #f0fff4; }
        .option-btn input { margin-right: 15px; transform: scale(1.3); accent-color: var(--primary); }
        .option-btn.correct { background: #f0fff4; border-color: var(--success); color: #22543d; animation: pulse 0.5s; }
        .option-btn.wrong { background: #fff5f5; border-color: var(--error); color: #742a2a; animation: shake 0.5s; }
        .option-btn.info-select { background: #ebf8ff; border-color: var(--info); color: #2c5282; }
        .option-btn.disabled { pointer-events: none; opacity: 0.7; }
        .input-area { display: none; margin-left: 20px; margin-top: 10px; padding-left: 15px; border-left: 3px solid #e2e8f0; animation: slideIn 0.3s; }
        .custom-input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; font-family: inherit; font-size: 1em; transition: border 0.3s; }
        .custom-input:focus { border-color: var(--primary); outline: none; }
        .validate-btn, .start-btn { background: var(--secondary); color: white; border: none; padding: 12px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; transition: background 0.3s, transform 0.2s; box-shadow: 0 4px 10px rgba(230, 126, 34, 0.3); }
        .validate-btn:hover, .start-btn:hover { background: #d35400; transform: translateY(-2px); }
        .validate-btn:disabled { background: #cbd5e0; cursor: default; transform: none; box-shadow: none; }
        .feedback { margin-top: 20px; padding: 15px; border-radius: 12px; font-size: 0.95em; display: none; animation: slideIn 0.3s ease-out; }
        .fb-success { background: #c6f6d5; color: #22543d; border: 1px solid #9ae6b4; }
        .fb-error { background: #fed7d7; color: #742a2a; border: 1px solid #feb2b2; }
        .fb-info { background: #bee3f8; color: #2a4365; border: 1px solid #90cdf4; }
        #intro-panel { text-align: center; background: white; padding: 50px 30px; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); margin-top: 40px; animation: fadeInUp 0.5s; border-bottom: 8px solid var(--primary); }
        #final-section { text-align: center; background: white; padding: 50px; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); display: none; margin-top: 50px; position: relative; z-index: 10; border-top: 8px solid var(--success); }
        .score-circle { width: 140px; height: 140px; background: linear-gradient(135deg, var(--primary), #6b8f3a); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3em; font-weight: bold; margin: 0 auto 20px auto; box-shadow: 0 10px 25px rgba(107, 143, 58, 0.4); animation: popIn 0.8s; }
        .save-status { margin-top: 15px; font-size: 0.9em; color: #718096; font-style: italic; }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .d-1 { animation-delay: 0.1s; } .d-2 { animation-delay: 0.2s; } .d-3 { animation-delay: 0.3s; } .d-4 { animation-delay: 0.4s; }
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
    </style>
</head>
<body>

<div class="wave-top"></div>
<div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
<canvas id="confetti-canvas"></canvas>

<div class="container">
    <header>
        <h1>Le Challenge du Partenaire Expert üéØ</h1>
        <p class="intro">Vous connaissez le territoire par c≈ìur ? Prouvez-le !<br>R√©pondez aux 7 questions pour d√©couvrir votre niveau d'expertise.</p>
    </header>

    <!-- ECRAN DE DEMARRAGE (RAISON SOCIALE) -->
    <div id="intro-panel">
        <h2 style="color: var(--primary-dark); margin-bottom: 30px;">Bienvenue ! üëã</h2>
        
        <label for="companyInput" style="display:block; margin-bottom:10px; color:#666; font-weight:600;">Nom de votre structure :</label>
        <input type="text" id="companyInput" class="custom-input" placeholder="Ex: Restaurant Chez Pierre..." autofocus>
        
        <button class="start-btn" onclick="startQuiz()">Commencer</button>
    </div>

    <!-- CONTENU DU QUIZZ -->
    <div id="quiz-content" style="display:none;">
        
        <!-- SECTION 1 -->
        <div class="section-badge d-1">1. Le Territoire</div>
        
        <div class="card d-1" id="card-A">
            <h3>üìç O√π peut-on trouver des ar√®nes en Pays Tarusate ?</h3>
            <span class="hint">(Plusieurs r√©ponses possibles)</span>
            <div class="options-grid">
                <label class="option-btn"><input type="checkbox" value="begaar"> B√©gaar</label>
                <label class="option-btn"><input type="checkbox" value="souprosse"> Souprosse</label>
                <label class="option-btn"><input type="checkbox" value="meilhan"> Meilhan</label>
                <label class="option-btn"><input type="checkbox" value="tartas"> Tartas</label>
                <label class="option-btn"><input type="checkbox" value="rion"> Rion-des-Landes</label>
            </div>
            <button class="validate-btn" onclick="validateCheckboxQ(this)">Valider</button>
            <div class="feedback"></div>
        </div>

        <div class="card d-2">
            <h3>üó∫Ô∏è Qu‚Äôest-ce que T√®rra Aventura ?</h3>
            <div class="options-grid">
                <label class="option-btn" onclick="checkRadio(this, false, 'Le p√¢t√© landais est d√©licieux... mais non !')"><input type="radio" name="qB"> Une nouvelle marque de p√¢t√© landais</label>
                <label class="option-btn" onclick="checkRadio(this, true, '‚úÖ Exactement ! Une application qui cartonne.')"><input type="radio" name="qB"> Une chasse aux tr√©sors connect√©e</label>
                <label class="option-btn" onclick="checkRadio(this, false, 'Pas tout √† fait !')"><input type="radio" name="qB"> Un parcours commando</label>
                <label class="option-btn" onclick="checkRadio(this, false, 'Non, Charlotte est notre Directrice !')"><input type="radio" name="qB"> Le surnom de la Directrice</label>
            </div>
            <div class="feedback"></div>
        </div>

        <!-- SECTION 2 -->
        <div class="section-badge d-3">2. La Structure</div>

        <div class="card d-3">
            <h3>üí∞ Qui est notre Tr√©sorier actuel ?</h3>
            <div class="options-grid">
                <label class="option-btn" onclick="checkRadio(this, false, 'Perdu, Maurice est notre Secr√©taire.')"><input type="radio" name="qC"> Maurice Testemale</label>
                <label class="option-btn" onclick="checkRadio(this, true, '‚úÖ Bravo ! Bernard Dehez veille sur nos finances.')"><input type="radio" name="qC"> Bernard Dehez</label>
                <label class="option-btn" onclick="checkRadio(this, false, 'Non, c\'est Bernard Dehez.')"><input type="radio" name="qC"> Pierre Cazenave</label>
                <label class="option-btn" onclick="checkRadio(this, false, 'Non, Cyril est notre Co-Pr√©sident !')"><input type="radio" name="qC"> Cyril Dubos</label>
            </div>
            <div class="feedback"></div>
        </div>

        <div class="card d-4">
            <h3>üë©‚Äçüíº Quel est le r√¥le de Charlotte Lavie ?</h3>
            <div class="options-grid">
                <label class="option-btn" onclick="checkRadio(this, false, 'Non, Manon est conseill√®re, Charlotte est Directrice.')"><input type="radio" name="qD"> Conseill√®re en s√©jour</label>
                <label class="option-btn" onclick="checkRadio(this, true, '‚úÖ Tout juste ! Charlotte Lavie est notre Directrice.')"><input type="radio" name="qD"> Directrice / Responsable</label>
                <label class="option-btn" onclick="checkRadio(this, false, 'Non, la Pr√©sidence est assur√©e par des √©lus b√©n√©voles.')"><input type="radio" name="qD"> Pr√©sidente de l'association</label>
            </div>
            <div class="feedback"></div>
        </div>

        <div class="card" id="card-E">
            <h3>ü§ù Connaissez-vous au moins 3 autres adh√©rents (hors de votre commune) ?</h3>
            <div class="options-grid">
                <label class="option-btn" onclick="handleOptionE(this, true)"><input type="radio" name="qE" value="oui"> Oui, bien s√ªr !</label>
                <div id="area-E" class="input-area">
                    <p style="margin: 0 0 5px 0; color: #718096; font-size: 0.9em;">Citez-les ici :</p>
                    <input type="text" id="input-E" class="custom-input" placeholder="Ex: G√Æte du Ch√™ne, Restaurant Le Centre...">
                    <button class="validate-btn" style="margin-top:0;" onclick="validateE()">Valider</button>
                </div>
                <label class="option-btn" onclick="handleOptionE(this, false)"><input type="radio" name="qE" value="non"> Non...</label>
            </div>
            <div class="feedback"></div>
        </div>

        <!-- SECTION 3 -->
        <div class="section-badge">3. Les Services</div>

        <div class="card">
            <h3>üéüÔ∏è Le saviez-vous ? Nous proposons un service de billetterie complet pour VOS √©v√©nements.</h3>
            <div class="options-grid">
                <label class="option-btn" onclick="showInfo(this, '‚ÑπÔ∏è Parfait ! N\'h√©sitez pas √† l\'utiliser.')"><input type="radio" name="qF"> Je le savais !</label>
                <label class="option-btn" onclick="showInfo(this, '‚ÑπÔ∏è Et oui ! Via Tikera, nous vendons vos places.')"><input type="radio" name="qF"> Je l'apprends √† l'instant.</label>
            </div>
            <div class="feedback"></div>
        </div>

        <div class="card">
            <h3>üõèÔ∏è Quel outil l'OT fournit-il aux h√©bergeurs pour accueillir vos clients ?</h3>
            <div class="options-grid">
                <label class="option-btn" onclick="checkRadio(this, false, 'On aimerait bien ! Mais non.')"><input type="radio" name="qG"> Un panier garni</label>
                <label class="option-btn" onclick="checkRadio(this, true, '‚úÖ Exact ! Le Kit de Bienvenue.')"><input type="radio" name="qG"> Un Kit de Bienvenue</label>
                <label class="option-btn" onclick="checkRadio(this, false, 'Non, mais avouez que ce serait classe !')"><input type="radio" name="qG"> Un parasol</label>
            </div>
            <div class="feedback"></div>
        </div>

        <!-- RESULTAT -->
        <div id="final-section">
            <div class="score-circle" id="final-score">0/7</div>
            <div class="final-msg" id="final-title">Titre</div>
            <p class="final-sub" id="final-desc">Description</p>
            <p class="save-status" id="save-msg">Sauvegarde du r√©sultat...</p>
        </div>
    </div>

</div>

<script>
    // ---------------------------------------------------------
    // 1. URL DE TON GOOGLE APPS SCRIPT
    // ---------------------------------------------------------
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyP0_-V68eobXnkuBWwsvd0_GJSSHdBeei4cANETkYLfj5R5A2dbFq85nC7Y_nWevh-rQ/exec"; 

    // ---------------------------------------------------------
    // 2. LOGIQUE DU QUIZZ
    // ---------------------------------------------------------
    let score = 0;
    const totalQ = 7;
    let answered = 0;
    let companyName = ""; // Variable pour stocker la raison sociale
    let answersDetail = {
        qA: "", qB: "", qC: "", qD: "", qE: "", qF: "", qG: ""
    };

    // Fonction de d√©marrage
    function startQuiz() {
        const input = document.getElementById('companyInput');
        if(input.value.trim().length < 2) {
            alert("Merci d'indiquer le nom de votre structure pour commencer !");
            return;
        }
        companyName = input.value.trim(); // On sauvegarde le nom
        
        // Animation de transition
        document.getElementById('intro-panel').style.display = 'none';
        document.getElementById('quiz-content').style.display = 'block';
    }

    function updateProgress() {
        const percent = (answered / totalQ) * 100;
        document.getElementById('progressBar').style.width = percent + '%';
    }

    // Gestion Radio Boutons (Vrai/Faux)
    function checkRadio(element, isCorrect, message) {
        const card = element.closest('.card');
        if (card.classList.contains('answered')) return;
        
        card.classList.add('answered');
        answered++;
        updateProgress();
        
        // Stockage de la r√©ponse (Texte)
        const input = element.querySelector('input');
        answersDetail[input.name] = element.textContent.trim();

        card.querySelectorAll('.option-btn').forEach(btn => btn.classList.add('disabled'));
        const feedback = card.querySelector('.feedback');
        feedback.style.display = 'block'; feedback.innerText = message;
        if (isCorrect) { score++; element.classList.add('correct'); feedback.className = 'feedback fb-success'; } 
        else { element.classList.add('wrong'); feedback.className = 'feedback fb-error'; }
        checkEnd();
    }

    // Gestion Info (Toujours juste)
    function showInfo(element, message) {
        const card = element.closest('.card');
        if (card.classList.contains('answered')) return;
        
        card.classList.add('answered');
        answered++; score++; updateProgress();
        
        // Stockage
        const input = element.querySelector('input');
        answersDetail[input.name] = element.textContent.trim();

        card.querySelectorAll('.option-btn').forEach(btn => btn.classList.add('disabled'));
        const feedback = card.querySelector('.feedback');
        feedback.style.display = 'block'; feedback.innerText = message; feedback.className = 'feedback fb-info'; element.classList.add('info-select');
        checkEnd();
    }

    // Gestion Question E
    function handleOptionE(btn, isYes) {
        const card = document.getElementById('card-E');
        if (card.classList.contains('answered')) return;
        const area = document.getElementById('area-E');
        const allBtns = card.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.classList.remove('info-select'));
        if (isYes) {
            area.style.display = 'block'; btn.classList.add('info-select');
        } else {
            area.style.display = 'none'; 
            answersDetail.qE = "Non"; // Stockage direct si Non
            showInfo(btn, '‚ÑπÔ∏è Pas de souci, nos petits-d√©j et AG sont l√† pour √ßa !');
        }
    }

    function validateE() {
        const card = document.getElementById('card-E');
        const input = document.getElementById('input-E');
        const feedback = card.querySelector('.feedback');
        if(input.value.trim().length < 2) { alert("Merci de citer au moins un adh√©rent :)"); return; }
        
        answersDetail.qE = input.value; // Stockage de la saisie

        card.classList.add('answered'); answered++; score++; updateProgress();
        card.querySelectorAll('.option-btn').forEach(btn => btn.classList.add('disabled'));
        document.getElementById('area-E').querySelectorAll('input, button').forEach(el => el.disabled = true);
        feedback.style.display = 'block'; feedback.innerText = '‚ÑπÔ∏è Super ! Le r√©seau est notre force.'; feedback.className = 'feedback fb-info';
        checkEnd();
    }

    // Gestion Checkbox (Question A)
    function validateCheckboxQ(btn) {
        const card = document.getElementById('card-A');
        const inputs = card.querySelectorAll('input:checked');
        const values = Array.from(inputs).map(i => i.value);
        
        // Pour le stockage, on prend les labels
        const textValues = Array.from(inputs).map(i => i.parentElement.textContent.trim());
        answersDetail.qA = textValues.join(", ");

        const feedback = card.querySelector('.feedback');
        const correct = ['begaar', 'souprosse', 'rion'];
        const hasAllCorrect = correct.every(v => values.includes(v));
        const hasNoWrong = !values.includes('meilhan') && !values.includes('tartas');
        
        card.classList.add('answered'); answered++; updateProgress();
        btn.disabled = true; btn.innerText = "Valid√©";
        card.querySelectorAll('input').forEach(i => i.disabled = true);
        feedback.style.display = 'block';
        if (hasAllCorrect && hasNoWrong) { score++; feedback.innerHTML = "<strong>‚úÖ Bravo !</strong> B√©gaar, Souprosse et Rion sont les bonnes r√©ponses."; feedback.className = "feedback fb-success"; } 
        else { feedback.innerHTML = "<strong>‚ùå Pas tout √† fait.</strong> Les ar√®nes sont √† B√©gaar, Souprosse et Rion."; feedback.className = "feedback fb-error"; }
        checkEnd();
    }

    function checkEnd() { if (answered === totalQ) { setTimeout(showFinalResult, 500); } }

    function showFinalResult() {
        const section = document.getElementById('final-section');
        const scoreDisplay = document.getElementById('final-score');
        const title = document.getElementById('final-title');
        const desc = document.getElementById('final-desc');
        section.style.display = 'block'; section.scrollIntoView({ behavior: 'smooth' });

        let current = 0;
        const timer = setInterval(() => {
            current++; scoreDisplay.innerText = current + "/" + totalQ;
            if (current >= score) clearInterval(timer);
        }, 100);

        if (score === 7) { title.innerText = "üèÜ Expert Absolu !"; desc.innerText = "Wow ! Vous connaissez le Pays Tarusate sur le bout des doigts."; startConfetti(); } 
        else if (score >= 5) { title.innerText = "ü•à Excellent Connaisseur !"; desc.innerText = "Bravo ! Vous ma√Ætrisez tr√®s bien votre sujet."; startConfetti(); } 
        else { title.innerText = "ü•â Merci pour votre participation !"; desc.innerText = "C'est un bon d√©but ! L'√©quipe est l√† pour vous accompagner."; }

        sendDataToSheet();
    }

    // --- ENVOI VERS GOOGLE SHEET ---
    function sendDataToSheet() {
        const msg = document.getElementById('save-msg');
        if(GOOGLE_SCRIPT_URL.includes("COLLE_TON_NOUVEAU_LIEN_ICI")) {
            msg.innerText = "‚ö†Ô∏è Erreur : L'URL du script n'a pas √©t√© configur√©e.";
            return;
        }

        const dataToSend = {
            companyName: companyName, // On ajoute le nom de la structure
            score: score + " / " + totalQ,
            // On envoie le d√©tail de toutes les r√©ponses
            ...answersDetail
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Important pour Google Scripts
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dataToSend)
        })
        .then(() => {
            msg.innerText = "‚úÖ R√©sultat enregistr√© avec succ√®s !";
            msg.style.color = "green";
        })
        .catch(err => {
            console.error(err);
            msg.innerText = "‚ö†Ô∏è Erreur lors de l'enregistrement.";
        });
    }

    function startConfetti() {
        const canvas = document.getElementById("confetti-canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const pieces = []; const colors = ['#88b04b', '#e67e22', '#3498db', '#e74c3c', '#f1c40f'];
        for (let i = 0; i < 150; i++) pieces.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height - canvas.height, w: Math.random() * 10 + 5, h: Math.random() * 10 + 5, color: colors[Math.floor(Math.random() * colors.length)], speed: Math.random() * 3 + 2, angle: Math.random() * 2 * Math.PI });
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            pieces.forEach(p => {
                ctx.fillStyle = p.color; ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.angle); ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h); ctx.restore();
                p.y += p.speed; p.angle += 0.1; if (p.y > canvas.height) p.y = -20;
            });
            requestAnimationFrame(draw);
        }
        draw();
    }
</script>

</body>
</html>
